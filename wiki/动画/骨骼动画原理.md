
# 模型动画的分类

基本原理是让模型中各顶点的位置随时间变化。从动画数据的角度来说，三者一般都采用关键帧技术，即只给出关键帧的数据，其他帧的数据使用插值得到。

## Morph（变形）动画

直接指定动画每一帧的顶点位置，其动画关键中存储的是Mesh所有顶点在关键帧对应时刻的位置。

## 关节动画

模型不是一个整体的Mesh，而是分成很多部分（Mesh），通过一个父子层次结构将这些分散的Mesh组织在一起，父Mesh带动其下子Mesh的运动，各Mesh中的顶点坐标定义在自己的坐标系中，这样各个Mesh是作为一个整体参与运动的。关节动画的问题是，各部分Mesh中的顶点是固定在其Mesh坐标系中的，这样在两个Mesh结合处就可能产生裂缝。

## 骨骼蒙皮（Skinned Mesh）动画

类似于关节动画，但是骨骼蒙皮动画解决了关节动画的裂缝问题。在骨骼控制下，通过顶点混合动态计算蒙皮网格的顶点，而骨骼的运动相对于其父骨骼，并由动画关键帧数据驱动。一个骨骼动画通常包括骨骼层次结构数据，网格（Mesh）数据，网格蒙皮数据（skin info）和骨骼的动画（关键帧）数据。

# 骨骼动画原理

动画中包含骨骼（Bone）和蒙皮（Skinned Mesh）两个部分，Bone的层次结构和关节动画类似，Mesh则和关节动画不同：关节动画中是使用多个分散的Mesh，而Skinned Mesh中Mesh是一个整体，也就是说只有一个Mesh，实际上如果没有骨骼让Mesh运动变形，Mesh就和静态模型一样。

**骨骼蒙皮动画的技术精华在于蒙皮，所谓的皮并不是模型的贴图，而是Mesh本身，蒙皮是指将Mesh中的顶点附着（绑定）在骨骼之上，而且每个顶点可以被多个骨骼所控制，这样在关节处的顶点由于同时受到父子骨骼的拉扯而改变位置就消除了裂缝。**

具有蒙皮信息的Mesh或可当做皮肤用的Mesh，这个皮肤就是Mesh。而为了有皮肤功能，Mesh还需要蒙皮信息，即Skin数据，没有Skin数据就是一个普通的静态Mesh了。Skin数据决定顶点如何绑定到骨骼上。顶点的Skin数据包括顶点受哪些骨骼影响以及这些骨骼影响该顶点时的权重（weight），另外对于每块骨骼还需要骨骼偏移矩阵（BoneOffsetMatrix）用来将顶点从Mesh空间变换到骨骼空间。

骨骼控制蒙皮运动，而骨骼本身的运动呢？当然是动画数据了。每个关键帧中包含时间和骨骼运动信息，运动信息可以用一个矩阵直接表示骨骼新的变换，也可用四元数表示骨骼的旋转，也可以随便自己定义什么只要能让骨骼动就行。除了使用编辑设定好的动画帧数据，也可以使用物理计算对骨骼进行实时控制。

## 骨骼

可以将骨骼简单的看做一个树形结构，每个骨骼都可以有一个父骨骼，每个骨骼的坐标变换都是基于父骨骼的，父骨骼移动或旋转，子骨骼本地坐标不变，但是全局坐标也会跟随父骨骼进行变化。

## 蒙皮

Mesh是作为皮肤使用，蒙在骨骼之上的。为了让普通的Mesh具有蒙皮的功能，必须添加蒙皮信息，**蒙皮信息针对每个顶点，即每个顶点，需要关联上一个或多个骨骼，并且要告知每个骨骼对这个顶点影响的权重，所有的权重加上应为1。**

可以理解为，每个顶点在动画中的具体位置，是由其关联的多个骨骼的转换信息，加由影响的权重运算出来的，其运算代码在片段着色器中。

**注：一般来说，一个顶点最多可以关联4个骨骼，大部分的游戏引擎比如Unity都是最多支持4个。**

## 动画实现

通过插值，运算出指定帧率下每帧的骨骼坐标。

比如：美术在制作骨骼动画时，当前帧和下一帧之间的间隔可能是比较长的，比如间隔0.5秒，我们的帧率如果是60帧，就需要通过插值算出30帧的骨骼坐标信息，实际绘制的时候，将对应的骨骼坐标信息传入之后进行绘制即可。
